<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HC Conecta - MVP</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/pages/index/index.css">
</head>

<body>
    <main class="container">
        <div class="header">
            <h1>HC Conecta</h1>
            <p>Protótipo de MVP Integrado</p><br>
            <div class="nav-buttons">
                <button onclick="showPage('checkin-page')">Check<br>in</button>
                <button onclick="showPage('patient-guide-page')">Guia do Paciente</button>
                <button onclick="showPage('painel-page')">Painel da Equipe</button>
                <button onclick="showPage('patient-history-page')">Histórico do Dia</button>
                <button onclick="showPage('wearable-page')">HC Core</button>
                <button onclick="showPage('decentralized-page')">Agendamentos</button>
            </div>
        </div>

        <section id="checkin-page" class="page active">
            <div class="checkin-form">
                <h2>Check-in Inteligente</h2><br>
                <form id="checkinForm">
                    <label for="name">Nome Completo:</label>
                    <input type="text" id="name" name="name" placeholder="Ex: José Ferreira" required>
                    <label for="cpf">CPF ou CNS:</label>
                    <input type="text" id="cpf" name="cpf" placeholder="Ex: 123.456.789-00" required>
                    <label for="reason">Motivo da Visita:</label>
                    <input type="text" id="reason" name="reason" placeholder="Ex: Consulta com Cardiologista" required>
                    <button type="submit">Fazer Check-in</button>
                </form>
            </div>
        </section>

        <div id="subtle-confirmation" class="confirmation-message-subtle"></div>

        <section id="patient-guide-page" class="page">
            <div class="header">
                <h2>Guia do Paciente</h2>
                <p>Informações e orientações para o seu atendimento de hoje.</p>
            </div>
            <div class="patient-guide-card">
                <h3 id="guide-patient-name"></h3>
                <p>Você está aqui para o exame de **<span id="guide-exam-name"></span>**.</p>
                <p>Seu atendimento está agendado para às **<span id="guide-exam-time"></span>**.</p>
                <p>O local de atendimento é **<span id="guide-location"></span>**.</p>
                <p>Por favor, siga as sinalizações e dirija-se ao local. Um de nossos colaboradores estará à sua espera.
                </p>
            </div>
        </section>

        <section id="painel-page" class="page">
            <div class="header">
                <h2>Painel Assistencial</h2>
                <p>Acompanhe o status dos pacientes. Clique para ver o histórico completo.
                </p>
            </div>
            <div class="patient-list">
            </div>
        </section>

        <section id="patient-history-page" class="page">
            <div class="header">
                <h2>Histórico de Atendimento do Dia</h2>
                <p>Confira a lista de todos os pacientes que fizeram check-in hoje.</p>
            </div>
            <div class="patient-list" id="history-list">
            </div>
        </section>

        <section id="wearable-page" class="page">
            <div class="header">
                <h2>Monitoramento de Sinais Vitais</h2>
                <p>Dados de saúde em tempo real.</p>
            </div>
            <div id="wearable-list" class="wearable-list">
            </div>
        </section>

        <section id="decentralized-page" class="page">
            <div class="header">
                <h2>Cadastro de Exame Descentralizado</h2>
                <p>Indique o exame necessário para o paciente.</p>
            </div>
            <div class="decentralized-form-card">
                <form id="decentralizedForm">
                    <label for="patient-cpf">CPF do Paciente:</label>
                    <input type="text" id="patient-cpf" name="patient-cpf" placeholder="Ex: 123.456.789-00" required>
                    <label for="exam-description">Descrição do Exame:</label>
                    <input type="text" id="exam-description" name="exam-description"
                        placeholder="Ex: Hemograma completo" required>
                    <label for="exam-date">Data do Exame:</label>
                    <input type="date" id="exam-date" name="exam-date" required>
                    <button type="submit">Cadastrar Exame</button>
                </form>
                <div id="decentralized-confirmation" class="confirmation-message" style="display: none;">
                    <p id="decentralized-text">Exame cadastrado com sucesso.</p>
                </div>
            </div>
        </section>

        <section id="patient-details-page" class="page">
            <div class="header">
                <button onclick="showPage('painel-page')">← Voltar</button>
                <h2 id="patient-details-name">Detalhes do Paciente</h2>
                <p>Histórico completo de atividades.</p>
            </div>
            <ul id="timeline-list" class="timeline-list">
            </ul>
        </section>

    </main>

    <script>
        // === Parte de Dados e Lógica (API Simulada) ===
        let patientDatabase = [
            {
                name: "João da Silva",
                cpf: "123.456.789-00",
                status: "waiting",
                timeline: [{ date: "10/09/2025", description: "Raio-X em 10/09/2025", type: "regular" }],
                appointment: { exam: "Hemograma", time: "10:30h", location: "Unidade Lab Norte - Sala 3" }
            },
            {
                name: "Maria de Souza",
                cpf: "987.654.321-11",
                status: "in-service",
                timeline: [{ date: "01/08/2025", description: "Dermatologia em 01/08/2025", type: "regular" }],
                appointment: { exam: "Eletrocardiograma", time: "11:00h", location: "Bloco C - Setor de Cardiologia" }
            },
            {
                name: "Pedro Santos",
                cpf: "111.222.333-44",
                status: "done",
                timeline: [{ date: "15/09/2025", description: "Hemograma em 15/09/2025", type: "regular" }],
                appointment: { exam: "Ultrassonografia", time: "09:45h", location: "Imagem - Ala Sul" }
            }
        ];

        function checkinPatient(name, cpf, reason) {
            const existingPatient = patientDatabase.find(p => p.cpf === cpf);
            if (existingPatient) {
                return { success: false, message: "Paciente já fez o check-in." };
            }
            const newPatient = {
                name: name,
                cpf: cpf,
                status: "waiting",
                timeline: [{ date: new Date().toLocaleDateString('pt-BR'), description: `Check-in: ${reason}`, type: "regular" }],
                appointment: { exam: reason, time: `${Math.floor(Math.random() * (16 - 9 + 1)) + 9}:00h`, location: "Clínica de Especialidades - Andar 2" }
            };
            patientDatabase.push(newPatient);
            console.log(`Paciente ${newPatient.name} (CPF: ${newPatient.cpf}) adicionado. Total: ${patientDatabase.length}`);
            return { success: true, message: "Check-in realizado com sucesso.", patientData: newPatient };
        }

        function getPatients() {
            return patientDatabase;
        }

        function simulatePatientFlow() {
            const today = new Date().toLocaleDateString('pt-BR');
            patientDatabase.forEach(patient => {
                if (patient.status === 'waiting') {
                    patient.status = 'in-service';
                    patient.timeline.push({ date: today, description: "Consulta Iniciada", type: "regular" });
                } else if (patient.status === 'in-service') {
                    patient.status = 'done';
                    patient.timeline.push({ date: today, description: "Atendimento Concluído", type: "regular" });
                } else if (patient.status === 'done') {
                    patient.status = 'waiting';
                    patient.timeline.push({ date: today, description: "Retorno Agendado", type: "regular" });
                }
            });
            renderPatients();
        }

        // === Parte de Lógica da Interface (UI) ===
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            if (pageId === 'painel-page') {
                renderPatients();
            }
            if (pageId === 'wearable-page') {
                renderWearableData();
            }
            if (pageId === 'patient-history-page') {
                renderPatientHistory();
            }
        }

        function showPatientGuide(patient) {
            document.getElementById('guide-patient-name').textContent = `Olá, ${patient.name}!`;
            document.getElementById('guide-exam-name').textContent = patient.appointment.exam;
            document.getElementById('guide-exam-time').textContent = patient.appointment.time;
            document.getElementById('guide-location').textContent = patient.appointment.location;
            showPage('patient-guide-page');
        }

        function showPatientDetails(cpf) {
            const patient = patientDatabase.find(p => p.cpf === cpf);
            if (!patient) {
                alert("Paciente não encontrado!");
                return;
            }

            document.getElementById('patient-details-name').textContent = `Detalhes do Paciente: ${patient.name}`;
            const timelineList = document.getElementById('timeline-list');
            timelineList.innerHTML = '';

            // Lógica de ordenação e formatação
            patient.timeline.sort((a, b) => {
                const dateA = a.date.split('/').reverse().join('');
                const dateB = b.date.split('/').reverse().join('');
                return dateA.localeCompare(dateB);
            });

            patient.timeline.forEach(event => {
                const listItem = document.createElement('li');
                // Adicionando a classe de destaque se for um exame descentralizado
                if (event.type === 'decentralized-exam') {
                    listItem.classList.add('decentralized-exam');
                }
                listItem.innerHTML = `
                    <h4>${event.description}</h4>
                    <p>Data: ${event.date}</p>
                `;
                timelineList.appendChild(listItem);
            });

            showPage('patient-details-page');
        }

        const checkinForm = document.getElementById('checkinForm');
        checkinForm.addEventListener('submit', function (event) {
            event.preventDefault();
            const name = document.getElementById('name').value;
            const cpf = document.getElementById('cpf').value;
            const reason = document.getElementById('reason').value;
            const response = checkinPatient(name, cpf, reason);

            const subtleMessage = document.getElementById('subtle-confirmation');

            if (response.success) {
                subtleMessage.textContent = `Olá, ${name}! Check-in realizado.`;
                subtleMessage.classList.add('show');
                showPatientGuide(response.patientData);
            } else {
                subtleMessage.textContent = `Erro: ${response.message}`;
                subtleMessage.style.backgroundColor = '#dc3545';
                subtleMessage.classList.add('show');
            }

            setTimeout(() => {
                subtleMessage.classList.remove('show');
                subtleMessage.style.backgroundColor = '#28a745';
                checkinForm.reset();
            }, 3000);
        });

        function renderPatients() {
            const patientListContainer = document.querySelector('.patient-list');
            const patientsToRender = getPatients();
            patientListContainer.innerHTML = '';

            patientsToRender.forEach(patient => {
                const statusText = patient.status === 'waiting' ? 'Aguardando' : (patient.status === 'in-service' ? 'Em Atendimento' : 'Concluído');
                const statusClass = patient.status;

                const lastActivity = patient.timeline[patient.timeline.length - 1];
                const timelineSummary = `<strong>Última Atividade:</strong> ${lastActivity.description}`;

                const patientCardHTML = `
                    <div class="patient-card" data-status="${patient.status}" onclick="showPatientDetails('${patient.cpf}')">
                        <div class="patient-info">
                            <h2 class="patient-name">${patient.name}</h2>
                            <p class="patient-id">CPF: ${patient.cpf}</p>
                        </div>
                        <div class="status-badge ${statusClass}">${statusText}</div>
                        <div class="timeline-summary">
                            <p>${timelineSummary}</p>
                        </div>
                    </div>
                `;
                patientListContainer.innerHTML += patientCardHTML;
            });
        }

        function renderPatientHistory() {
            const historyListContainer = document.getElementById('history-list');
            const patientsToRender = getPatients();
            historyListContainer.innerHTML = '';

            patientsToRender.forEach(patient => {
                const firstCheckin = patient.timeline.find(event => event.description.startsWith('Check-in:'));
                const examReason = firstCheckin ? firstCheckin.description.replace('Check-in: ', '') : 'Não informado';

                const patientHistoryCardHTML = `
                    <div class="patient-card">
                        <div class="patient-info">
                            <h2 class="patient-name">${patient.name}</h2>
                            <p class="patient-id">CPF: ${patient.cpf}</p>
                            <p><strong>Motivo da Visita:</strong> ${examReason}</p>
                        </div>
                    </div>
                `;
                historyListContainer.innerHTML += patientHistoryCardHTML;
            });
        }

        function renderWearableData() {
            const wearableListContainer = document.getElementById('wearable-list');
            wearableListContainer.innerHTML = '';

            const patientsToRender = getPatients();

            patientsToRender.forEach(patient => {
                const heartRate = Math.floor(Math.random() * (90 - 70 + 1)) + 70;
                const bodyTemp = (Math.random() * (37.5 - 36.5) + 36.5).toFixed(1);

                const wearableCardHTML = `
                    <div class="wearable-data-card">
                        <h3>Paciente: ${patient.name}</h3>
                        <div class="data-group">
                            <p>Batimento Cardíaco:</p>
                            <p class="data-value">${heartRate} bpm</p>
                        </div>
                        <div class="data-group">
                            <p>Temperatura Corporal:</p>
                            <p class="data-value">${bodyTemp} °C</p>
                        </div>
                    </div>
                `;
                wearableListContainer.innerHTML += wearableCardHTML;
            });
        }

        const decentralizedForm = document.getElementById('decentralizedForm');
        decentralizedForm.addEventListener('submit', function (event) {
            event.preventDefault();

            const cpf = document.getElementById('patient-cpf').value;
            const examDescription = document.getElementById('exam-description').value;
            const examDate = document.getElementById('exam-date').value;

            const patient = patientDatabase.find(p => p.cpf === cpf);
            const confirmationMessage = document.getElementById('decentralized-confirmation');
            const confirmationText = document.getElementById('decentralized-text');

            if (patient) {
                const [year, month, day] = examDate.split('-');
                const formattedDate = `${day}/${month}/${year}`;

                patient.timeline.push({ date: formattedDate, description: `Exame Descentralizado: ${examDescription}`, type: "decentralized-exam" });
                confirmationText.textContent = `Exame cadastrado com sucesso para o paciente ${patient.name}.`;
            } else {
                confirmationText.textContent = `Erro: Paciente com CPF ${cpf} não encontrado.`;
            }

            confirmationMessage.style.display = 'block';
            setTimeout(() => {
                confirmationMessage.style.display = 'none';
                decentralizedForm.reset();
                renderPatients();
            }, 3000);
        });

        // Inicia as simulações
        setInterval(simulatePatientFlow, 7000);
        setInterval(renderWearableData, 2000);

        showPage('checkin-page');
    </script>
</body>

</html>