<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>HC Conecta - Sistema Hospitalar Inteligente</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/pages/index/index.css">
</head>

<body>
    <main class="container">
        <header class="header">
            <div class="header-content">
                <div class="logo" role="img" aria-label="Logotipo HC Conecta">
                    <i class="fas fa-hospital-symbol" aria-hidden="true"></i>
                    <h1>HC Conecta</h1>
                </div>
                <p>Sistema Hospitalar Inteligente - MVP Integrado</p>
            </div>
            <nav class="nav-buttons" aria-label="Seções do aplicativo">
                <button onclick="showPage('checkin-page')" class="nav-btn" aria-controls="checkin-page">
                    <i class="fas fa-user-check" aria-hidden="true"></i>
                    <span>Check-in</span>
                </button>
                <button onclick="showPage('patient-guide-page')" class="nav-btn" aria-controls="patient-guide-page">
                    <i class="fas fa-map-marked-alt" aria-hidden="true"></i>
                    <span>Guia do Paciente</span>
                </button>
                <button onclick="showPage('painel-page')" class="nav-btn" aria-controls="painel-page">
                    <i class="fas fa-users-cog" aria-hidden="true"></i>
                    <span>Painel da Equipe</span>
                </button>
                <button onclick="showPage('patient-history-page')" class="nav-btn" aria-controls="patient-history-page">
                    <i class="fas fa-history" aria-hidden="true"></i>
                    <span>Histórico do Dia</span>
                </button>
                <button onclick="showPage('wearable-page')" class="nav-btn" aria-controls="wearable-page">
                    <i class="fas fa-heartbeat" aria-hidden="true"></i>
                    <span>Monitoramento</span>
                </button>
                <button onclick="showPage('decentralized-page')" class="nav-btn" aria-controls="decentralized-page">
                    <i class="fas fa-calendar-plus" aria-hidden="true"></i>
                    <span>Agendamentos</span>
                </button>
            </nav>
        </header>

        <section id="checkin-page" class="page active" aria-labelledby="checkin-title">
            <div class="checkin-form card">
                <div class="form-header">
                    <i class="fas fa-user-check" aria-hidden="true"></i>
                    <h2 id="checkin-title">Check-in Inteligente</h2>
                    <p>Preencha os dados para realizar seu check-in</p>
                </div>
                <form id="checkinForm" novalidate>
                    <div class="input-grid">
                        <div class="input-group">
                            <label for="name">
                                <i class="fas fa-user" aria-hidden="true"></i>
                                Nome Completo
                            </label>
                            <input type="text" id="name" name="name" placeholder="Ex: José Ferreira" required>
                        </div>
                        <div class="input-group">
                            <label for="cpf">
                                <i class="fas fa-id-card" aria-hidden="true"></i>
                                CPF ou CNS
                            </label>
                            <input type="text" id="cpf" name="cpf" inputmode="numeric" autocomplete="off" placeholder="Ex: 123.456.789-00" required>
                        </div>
                        <div class="input-group input-group--full">
                            <label for="reason">
                                <i class="fas fa-stethoscope" aria-hidden="true"></i>
                                Motivo da Visita
                            </label>
                            <input type="text" id="reason" name="reason" placeholder="Ex: Consulta com Cardiologista" required>
                        </div>
                    </div>
                    <button class="btn btn-primary" type="submit">
                        <i class="fas fa-check-circle" aria-hidden="true"></i>
                        Fazer Check-in
                    </button>
                </form>
            </div>
        </section>

        <div id="subtle-confirmation" class="confirmation-message-subtle" role="status" aria-live="polite"></div>

        <section id="patient-guide-page" class="page" aria-labelledby="guide-title">
            <div class="header section-header">
                <h2 id="guide-title">Guia do Paciente</h2>
                <p>Informações e orientações para o seu atendimento de hoje.</p>
            </div>
            <div class="patient-guide-card card">
                <h3 id="guide-patient-name"></h3>
                <p>Você está aqui para o exame de <strong><span id="guide-exam-name"></span></strong>.</p>
                <p>Seu atendimento está agendado para às <strong><span id="guide-exam-time"></span></strong>.</p>
                <p>O local de atendimento é <strong><span id="guide-location"></span></strong>.</p>
                <p>Por favor, siga as sinalizações e dirija-se ao local. Um de nossos colaboradores estará à sua espera.</p>
            </div>
        </section>

        <section id="painel-page" class="page" aria-labelledby="painel-title">
            <div class="header section-header">
                <h2 id="painel-title">Painel Assistencial</h2>
                <p>Acompanhe o status dos pacientes. Clique para ver o histórico completo.</p>
            </div>
            <div class="patient-list responsive-grid"></div>
        </section>

        <section id="patient-history-page" class="page" aria-labelledby="history-title">
            <div class="header section-header">
                <h2 id="history-title">Histórico de Atendimento do Dia</h2>
                <p>Confira a lista de todos os pacientes que fizeram check-in hoje.</p>
            </div>
            <div class="patient-list" id="history-list"></div>
        </section>

        <section id="wearable-page" class="page" aria-labelledby="wearable-title">
            <div class="header section-header">
                <h2 id="wearable-title">Monitoramento de Sinais Vitais</h2>
                <p>Dados de saúde em tempo real.</p>
            </div>
            <div id="wearable-list" class="wearable-list responsive-grid"></div>
        </section>

        <section id="decentralized-page" class="page" aria-labelledby="decentralized-title">
            <div class="header section-header">
                <h2 id="decentralized-title">Cadastro de Exame Descentralizado</h2>
                <p>Indique o exame necessário para o paciente.</p>
            </div>
            <div class="decentralized-form-card card">
                <form id="decentralizedForm" novalidate>
                    <div class="input-grid">
                        <div class="input-group">
                            <label for="patient-cpf">CPF do Paciente:</label>
                            <input type="text" id="patient-cpf" name="patient-cpf" inputmode="numeric" placeholder="Ex: 123.456.789-00" required>
                        </div>
                        <div class="input-group">
                            <label for="exam-description">Descrição do Exame:</label>
                            <input type="text" id="exam-description" name="exam-description" placeholder="Ex: Hemograma completo" required>
                        </div>
                        <div class="input-group">
                            <label for="exam-date">Data do Exame:</label>
                            <input type="date" id="exam-date" name="exam-date" required>
                        </div>
                    </div>
                    <button class="btn btn-primary" type="submit">Cadastrar Exame</button>
                </form>
                <div id="decentralized-confirmation" class="confirmation-message" style="display: none;" role="status" aria-live="polite">
                    <p id="decentralized-text">Exame cadastrado com sucesso.</p>
                </div>
            </div>
        </section>

        <section id="patient-details-page" class="page" aria-labelledby="details-title">
            <div class="header section-header section-header--inline">
                <button class="btn btn-ghost" onclick="showPage('painel-page')" aria-controls="painel-page">← Voltar</button>
                <div>
                    <h2 id="details-title">Detalhes do Paciente</h2>
                    <p>Histórico completo de atividades.</p>
                </div>
            </div>
            <ul id="timeline-list" class="timeline-list"></ul>
        </section>

    </main>

    <script>
        // === Parte de Dados e Lógica (API Simulada) ===
        let patientDatabase = [
            {
                name: "João da Silva",
                cpf: "123.456.789-00",
                status: "waiting",
                timeline: [{ date: "10/09/2025", description: "Raio-X em 10/09/2025", type: "regular" }],
                appointment: { exam: "Hemograma", time: "10:30h", location: "Unidade Lab Norte - Sala 3" }
            },
            {
                name: "Maria de Souza",
                cpf: "987.654.321-11",
                status: "in-service",
                timeline: [{ date: "01/08/2025", description: "Dermatologia em 01/08/2025", type: "regular" }],
                appointment: { exam: "Eletrocardiograma", time: "11:00h", location: "Bloco C - Setor de Cardiologia" }
            },
            {
                name: "Pedro Santos",
                cpf: "111.222.333-44",
                status: "done",
                timeline: [{ date: "15/09/2025", description: "Hemograma em 15/09/2025", type: "regular" }],
                appointment: { exam: "Ultrassonografia", time: "09:45h", location: "Imagem - Ala Sul" }
            }
        ];

        function checkinPatient(name, cpf, reason) {
            const existingPatient = patientDatabase.find(p => p.cpf === cpf);
            if (existingPatient) {
                return { success: false, message: "Paciente já fez o check-in." };
            }
            const newPatient = {
                name: name,
                cpf: cpf,
                status: "waiting",
                timeline: [{ date: new Date().toLocaleDateString('pt-BR'), description: `Check-in: ${reason}`, type: "regular" }],
                appointment: { exam: reason, time: `${Math.floor(Math.random() * (16 - 9 + 1)) + 9}:00h`, location: "Clínica de Especialidades - Andar 2" }
            };
            patientDatabase.push(newPatient);
            return { success: true, message: "Check-in realizado com sucesso.", patientData: newPatient };
        }

        function getPatients() {
            return patientDatabase;
        }

        function simulatePatientFlow() {
            const today = new Date().toLocaleDateString('pt-BR');
            patientDatabase.forEach(patient => {
                if (patient.status === 'waiting') {
                    patient.status = 'in-service';
                    patient.timeline.push({ date: today, description: "Consulta Iniciada", type: "regular" });
                } else if (patient.status === 'in-service') {
                    patient.status = 'done';
                    patient.timeline.push({ date: today, description: "Atendimento Concluído", type: "regular" });
                } else if (patient.status === 'done') {
                    patient.status = 'waiting';
                    patient.timeline.push({ date: today, description: "Retorno Agendado", type: "regular" });
                }
            });
            renderPatients();
        }

        // === Parte de Lógica da Interface (UI) ===
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            if (pageId === 'painel-page') {
                renderPatients();
            }
            if (pageId === 'wearable-page') {
                renderWearableData();
            }
            if (pageId === 'patient-history-page') {
                renderPatientHistory();
            }
        }

        function showPatientGuide(patient) {
            document.getElementById('guide-patient-name').textContent = `Olá, ${patient.name}!`;
            document.getElementById('guide-exam-name').textContent = patient.appointment.exam;
            document.getElementById('guide-exam-time').textContent = patient.appointment.time;
            document.getElementById('guide-location').textContent = patient.appointment.location;
            showPage('patient-guide-page');
        }

        function showPatientDetails(cpf) {
            const patient = patientDatabase.find(p => p.cpf === cpf);
            if (!patient) {
                alert("Paciente não encontrado!");
                return;
            }

            document.getElementById('patient-details-name')?.remove();
            const detailsHeading = document.createElement('h2');
            detailsHeading.id = 'patient-details-name';
            detailsHeading.textContent = `Detalhes do Paciente: ${patient.name}`;

            const header = document.querySelector('#patient-details-page .section-header');
            if (header) header.appendChild(detailsHeading);

            const timelineList = document.getElementById('timeline-list');
            timelineList.innerHTML = '';

            patient.timeline.sort((a, b) => {
                const dateA = a.date.split('/').reverse().join('');
                const dateB = b.date.split('/').reverse().join('');
                return dateA.localeCompare(dateB);
            });

            patient.timeline.forEach(event => {
                const listItem = document.createElement('li');
                if (event.type === 'decentralized-exam') {
                    listItem.classList.add('decentralized-exam');
                }
                listItem.innerHTML = `
                    <h4>${event.description}</h4>
                    <p>Data: ${event.date}</p>
                `;
                timelineList.appendChild(listItem);
            });

            showPage('patient-details-page');
        }

        const checkinForm = document.getElementById('checkinForm');
        checkinForm.addEventListener('submit', function (event) {
            event.preventDefault();
            const name = document.getElementById('name').value.trim();
            const cpf = document.getElementById('cpf').value.trim();
            const reason = document.getElementById('reason').value.trim();
            if (!name || !cpf || !reason) return;

            const response = checkinPatient(name, cpf, reason);

            const subtleMessage = document.getElementById('subtle-confirmation');

            if (response.success) {
                subtleMessage.textContent = `Olá, ${name}! Check-in realizado.`;
                subtleMessage.classList.add('show');
                showPatientGuide(response.patientData);
            } else {
                subtleMessage.textContent = `Erro: ${response.message}`;
                subtleMessage.classList.add('show', 'error');
            }

            setTimeout(() => {
                subtleMessage.classList.remove('show', 'error');
                checkinForm.reset();
            }, 3000);
        });

        function renderPatients() {
            const patientListContainer = document.querySelector('.patient-list');
            const patientsToRender = getPatients();
            patientListContainer.innerHTML = '';

            patientsToRender.forEach(patient => {
                const statusText = patient.status === 'waiting' ? 'Aguardando' : (patient.status === 'in-service' ? 'Em Atendimento' : 'Concluído');
                const statusClass = patient.status;

                const lastActivity = patient.timeline[patient.timeline.length - 1];
                const timelineSummary = `<strong>Última Atividade:</strong> ${lastActivity.description}`;

                const wrapper = document.createElement('div');
                wrapper.className = 'patient-card card';
                wrapper.dataset.status = patient.status;
                wrapper.onclick = () => showPatientDetails(patient.cpf);
                wrapper.innerHTML = `
                    <div class=\"patient-info\">\n                        <h3 class=\"patient-name\">${patient.name}</h3>\n                        <p class=\"patient-id\">CPF: ${patient.cpf}</p>\n                    </div>\n                    <div class=\"status-badge ${statusClass}\">${statusText}</div>\n                    <div class=\"timeline-summary\">\n                        <p>${timelineSummary}</p>\n                    </div>\n                `;
                patientListContainer.appendChild(wrapper);
            });
        }

        function renderPatientHistory() {
            const historyListContainer = document.getElementById('history-list');
            const patientsToRender = getPatients();
            historyListContainer.innerHTML = '';

            patientsToRender.forEach(patient => {
                const firstCheckin = patient.timeline.find(event => event.description.startsWith('Check-in:'));
                const examReason = firstCheckin ? firstCheckin.description.replace('Check-in: ', '') : 'Não informado';

                const card = document.createElement('div');
                card.className = 'patient-card card';
                card.innerHTML = `
                    <div class=\"patient-info\">\n                        <h3 class=\"patient-name\">${patient.name}</h3>\n                        <p class=\"patient-id\">CPF: ${patient.cpf}</p>\n                        <p><strong>Motivo da Visita:</strong> ${examReason}</p>\n                    </div>\n                `;
                historyListContainer.appendChild(card);
            });
        }

        function renderWearableData() {
            const wearableListContainer = document.getElementById('wearable-list');
            wearableListContainer.innerHTML = '';

            const patientsToRender = getPatients();

            patientsToRender.forEach(patient => {
                const heartRate = Math.floor(Math.random() * (90 - 70 + 1)) + 70;
                const bodyTemp = (Math.random() * (37.5 - 36.5) + 36.5).toFixed(1);

                const card = document.createElement('div');
                card.className = 'wearable-data-card card';
                card.innerHTML = `
                    <h3>Paciente: ${patient.name}</h3>
                    <div class=\"data-group\">\n                        <p>Batimento Cardíaco:</p>\n                        <p class=\"data-value\">${heartRate} bpm</p>\n                    </div>\n                    <div class=\"data-group\">\n                        <p>Temperatura Corporal:</p>\n                        <p class=\"data-value\">${bodyTemp} °C</p>\n                    </div>\n                `;
                wearableListContainer.appendChild(card);
            });
        }

        const decentralizedForm = document.getElementById('decentralizedForm');
        decentralizedForm.addEventListener('submit', function (event) {
            event.preventDefault();

            const cpf = document.getElementById('patient-cpf').value.trim();
            const examDescription = document.getElementById('exam-description').value.trim();
            const examDate = document.getElementById('exam-date').value;

            const patient = patientDatabase.find(p => p.cpf === cpf);
            const confirmationMessage = document.getElementById('decentralized-confirmation');
            const confirmationText = document.getElementById('decentralized-text');

            if (patient) {
                const [year, month, day] = examDate.split('-');
                const formattedDate = `${day}/${month}/${year}`;

                patient.timeline.push({ date: formattedDate, description: `Exame Descentralizado: ${examDescription}`, type: "decentralized-exam" });
                confirmationText.textContent = `Exame cadastrado com sucesso para o paciente ${patient.name}.`;
                confirmationMessage.classList.remove('error');
            } else {
                confirmationText.textContent = `Erro: Paciente com CPF ${cpf} não encontrado.`;
                confirmationMessage.classList.add('error');
            }

            confirmationMessage.style.display = 'block';
            setTimeout(() => {
                confirmationMessage.style.display = 'none';
                decentralizedForm.reset();
                renderPatients();
            }, 3000);
        });

        // Inicia as simulações
        setInterval(simulatePatientFlow, 7000);
        setInterval(renderWearableData, 2000);

        showPage('checkin-page');
    </script>
</body>

</html>
